# Fluentd configuration for OCPP Central System audit logging
#
# This configuration receives OCPP events from Levity and can:
# - Output to stdout for development
# - Store in files for archival
# - Forward to Elasticsearch, S3, CloudWatch, etc.
#
# Usage:
#   fluentd -c fluent.conf

# Input: Receive events from Levity via forward protocol
<source>
  @type forward
  port 24224
  bind 0.0.0.0
</source>

# Development: Output all OCPP events to stdout
<match ocpp.**>
  @type stdout
</match>

# Example: Store events in daily log files
# <match ocpp.**>
#   @type file
#   path /var/log/fluentd/ocpp/${tag}/%Y%m%d
#   compress gzip
#   <buffer tag,time>
#     timekey 1d
#     timekey_wait 10m
#   </buffer>
#   <format>
#     @type json
#   </format>
# </match>

# Example: Forward to Elasticsearch
# <match ocpp.**>
#   @type elasticsearch
#   host elasticsearch.example.com
#   port 9200
#   index_name ocpp_events
#   type_name _doc
#   include_tag_key true
#   tag_key @log_name
#   <buffer>
#     @type memory
#     flush_interval 5s
#   </buffer>
# </match>

# Example: Send to AWS CloudWatch Logs
# <match ocpp.**>
#   @type cloudwatch_logs
#   log_group_name /ocpp/audit
#   log_stream_name ${tag}
#   auto_create_stream true
#   <buffer tag>
#     @type memory
#     flush_interval 5s
#   </buffer>
# </match>

# Example: Send to AWS S3 for long-term archival
# <match ocpp.**>
#   @type s3
#   s3_bucket ocpp-audit-logs
#   s3_region us-east-1
#   path logs/${tag}/%Y/%m/%d/
#   <buffer tag,time>
#     @type file
#     path /var/log/fluentd/s3
#     timekey 3600
#     timekey_wait 10m
#     chunk_limit_size 256m
#   </buffer>
#   <format>
#     @type json
#   </format>
# </match>

# Example: Filter and route by event type
# <match ocpp.transaction.**>
#   @type forward
#   <server>
#     host billing-system.example.com
#     port 24225
#   </server>
# </match>

# Example: Add metadata to all events
# <filter ocpp.**>
#   @type record_transformer
#   <record>
#     environment production
#     region us-east-1
#   </record>
# </filter>
